function Container(t){this.id=t,this.className="",this.htmlCode=""}function Basket(){Container.call(this,"basket"),this.countGoods=0,this.amount=0,this.basketItems=[],this.collectBasketItems()}function Slider(t){function e(){var t=$(s.selector);t.append('<a id="slider-nav-prev" class="product-hit__slider-nav-prev icon-left" href="#"></a>'),t.append('<a id="slider-nav-next" class="product-hit__slider-nav-next icon-right" href="#"></a>'),$("#slider-nav-prev").on("click",function(){t.find(".product-hit__item").remove();var e=a-1;e<0?(e=o.length-1,a=o.length-1):--a,i(e,"product-hit__item--current")}),$("#slider-nav-next").on("click",function(){t.find(".product-hit__item").remove();var e=a+1;e>o.length-1?(e=0,a=0):++a,i(e,"product-hit__item--current")})}function i(t,e){var i=$(s.selector).find(".product-hit__slider-wrapper"),a=$("<div />",{class:"product-hit__item "+e}),r=$("<div />",{class:"product-item__img",html:'<img src="'+o[t].img+'" alt="'+o[t].name+'">'}),n=$("<div />",{class:"product-item__title",text:o[t].name}),d=$("<div />",{class:"product-item__price",text:o[t].price+" "+o[t].currency});a.appendTo(i),r.appendTo(a),n.appendTo(a),d.appendTo(a)}this.selector=t;var s=this,o=[],a=0;$.ajax({url:"./product-hit.json",type:"get",dataType:"json",context:s,success:function(t){for(var s=0;s<t.length;s++)o.push(t[s]);i(a,"product-hit__item--current"),e()}})}Container.prototype.render=function(){return this.htmlCode},Basket.prototype=Object.create(Container.prototype),Basket.prototype.constructor=Basket,Basket.prototype.collectBasketItems=function(){var t="#"+this.id+"__data";$.ajax({url:"./basket.json",dataType:"json",type:"get",context:this,success:function(e){if(1===e.result){this.amount=e.amount,this.countGoods=e.basket.length;var i=$("<div />",{class:this.id+"__count",text:"Количество товаров: "+this.countGoods+" шт."}),s=$("<div />",{class:this.id+"__amount",text:"На сумму: "+this.amount+" руб."});i.appendTo(t),s.appendTo(t);for(var o=0;o<e.basket.length;o++)this.basketItems.push(e.basket[o])}else console.log("Обработка ошибки")}})},Basket.prototype.render=function(){var t=$("<div />",{class:this.id+"__title",text:"Корзина"}),e=$("<div />",{id:this.id+"__data"});t.appendTo("#"+this.id),e.appendTo("#"+this.id)},Basket.prototype.add=function(t,e){var i={id_product:+t,price:e};this.basketItems.push(i),this.amount+=e,this.countGoods+=1,this.refresh()},Basket.prototype.remove=function(t){t=+t;for(var e=0;e<this.basketItems.length;e++)this.basketItems[e].id_product===t&&(this.amount-=this.basketItems[e].price,this.countGoods-=1,this.basketItems.splice(e,1));this.refresh()},Basket.prototype.refresh=function(){var t=$("#basket__data"),e=t.find("."+this.id+"__count"),i=t.find("."+this.id+"__amount");e.empty(),i.empty(),e.text("Количество товаров: "+this.countGoods+" шт."),i.text("На сумму: "+this.amount+" руб.")},$(document).ready(function(){var t=new Basket;t.render("#basket__data"),$(".btn__buy").on("click",function(){var e=$(this).attr("data-prod-id"),i=parseFloat($(this).closest(".product-item").find(".product-item__price").text());t.add(e,i)}),$(".btn__remove").on("click",function(){var e=$(this).attr("data-prod-id");t.remove(e)});new Slider("#product-hit__slider");$(".product-item").draggable({opacity:.6,zIndex:100,revert:!0,cursor:"move"}),$("#basket").droppable({activeClass:"basket--active",hoverClass:"basket--hover",drop:function(e,i){var s=i.draggable[0].querySelector(".btn__buy").getAttribute("data-prod-id"),o=parseFloat(i.draggable[0].querySelector(".product-item__price").innerHTML);t.add(s,o)}})});